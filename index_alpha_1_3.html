<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>Редактор меню Minecraft (Alpha 1.3)</title>
<style>
  body {
    background: #1e1e2f;
    color: #eee;
    font-family: Arial, sans-serif;
    padding: 20px;
    max-width: 960px;
    margin: auto;
  }
  h2 { text-align: center; }
  label { display: block; margin: 8px 0 4px; }
  input[type="text"], input[type="number"], textarea {
    width: 100%;
    padding: 6px 10px;
    border: none;
    border-radius: 4px;
    background: #2e2e44;
    color: #eee;
    box-sizing: border-box;
  }
  input[type="checkbox"] { margin-right: 6px; }
  button {
    margin: 5px 5px 0 0;
    padding: 10px 20px;
    background: #3c6ef3;
    color: #fff;
    border: none;
    border-radius: 4px;
    cursor: pointer;
  }
  button:hover { background: #2b54c3; }
  #slotsGrid {
    display: grid;
    grid-template-columns: repeat(9, 50px);
    gap: 6px;
    margin: 20px 0;
  }
  .slot {
    background: #2a2a40;
    border-radius: 4px;
    width: 50px;
    height: 50px;
    color: #aaa;
    font-size: 9px;
    text-align: center;
    line-height: 50px;
    cursor: pointer;
    overflow: hidden;
    position: relative;
  }
  .slot.selected {
    outline: 3px solid #3c6ef3;
  }
  .slot img {
    max-width: 100%;
    max-height: 100%;
    display: block;
  }
  #itemList {
    background: #2a2a40;
    max-height: 120px;
    overflow-y: auto;
    border-radius: 4px;
    margin-top: 4px;
  }
  #itemList div {
    padding: 4px 8px;
    cursor: pointer;
  }
  #itemList div:hover {
    background: #3c6ef3;
  }
  pre {
    background: #111;
    padding: 10px;
    overflow-x: auto;
  }
</style>
</head>
<body>

<h2>Редактор меню Minecraft (Alpha 1.3)</h2>

<label>Название меню:</label>
<input type="text" id="menuName" placeholder="menu-name">

<label>Заголовок меню:</label>
<input type="text" id="menuTitle" placeholder="Меню">

<label>Линии (1–6):</label>
<input type="number" id="menuLines" min="1" max="6" value="3">

<label><input type="checkbox" id="closeMenu"> Закрывать меню при клике</label>

<label>Команды при открытии:</label>
<textarea id="onOpenCommands"></textarea>

<label>Команды при закрытии:</label>
<textarea id="onClosedCommands"></textarea>

<h3>Слоты:</h3>
<div id="slotsGrid"></div>

<h3>Редактор слота</h3>

<label>Поиск предмета:</label>
<input type="text" id="itemSearch" placeholder="Например: stone">
<div id="itemList"></div>

<label>Имя (display_name):</label>
<input type="text" id="displayName">

<label>Количество:</label>
<input type="number" id="itemCount" min="1" max="64" value="1">

<label>Лор (по одной строке):</label>
<textarea id="itemLore"></textarea>

<label><input type="checkbox" id="hideTooltip"> Скрыть подсказку</label>
<label><input type="checkbox" id="glow"> Подсвечивать</label>

<label>View Requirement Level:</label>
<input type="number" id="viewLevel" min="0" value="0">

<label>View Requirement String:</label>
<input type="text" id="viewString">

<label>on_left_click_commands:</label>
<textarea id="onLeftClick"></textarea>

<label>on_left_shift_click_commands:</label>
<textarea id="onLeftShiftClick"></textarea>

<label>on_right_click_commands:</label>
<textarea id="onRightClick"></textarea>

<label>on_right_shift_click_commands:</label>
<textarea id="onRightShiftClick"></textarea>

<label>on_middle_click_commands:</label>
<textarea id="onMiddleClick"></textarea>

<br/>
<button id="saveSlot">Сохранить слот</button>
<button id="clearSlots">Очистить всё</button>
<button id="generateJSON">Сгенерировать JSON</button>

<h3>Результат JSON:</h3>
<pre id="output"></pre>

<script>
  const slotsGrid = document.getElementById("slotsGrid");
  const menuNameInput = document.getElementById("menuName");
  const menuTitleInput = document.getElementById("menuTitle");
  const menuLinesInput = document.getElementById("menuLines");
  const closeMenuCheckbox = document.getElementById("closeMenu");
  const onOpenCommandsInput = document.getElementById("onOpenCommands");
  const onClosedCommandsInput = document.getElementById("onClosedCommands");

  const itemSearch = document.getElementById("itemSearch");
  const itemList = document.getElementById("itemList");
  const displayNameInput = document.getElementById("displayName");
  const itemCountInput = document.getElementById("itemCount");
  const itemLoreInput = document.getElementById("itemLore");
  const hideTooltipInput = document.getElementById("hideTooltip");
  const glowInput = document.getElementById("glow");
  const viewLevelInput = document.getElementById("viewLevel");
  const viewStringInput = document.getElementById("viewString");
  const onLeftClickInput = document.getElementById("onLeftClick");
  const onLeftShiftClickInput = document.getElementById("onLeftShiftClick");
  const onRightClickInput = document.getElementById("onRightClick");
  const onRightShiftClickInput = document.getElementById("onRightShiftClick");
  const onMiddleClickInput = document.getElementById("onMiddleClick");

  const outputPre = document.getElementById("output");
  const saveSlotBtn = document.getElementById("saveSlot");
  const clearSlotsBtn = document.getElementById("clearSlots");
  const generateJSONBtn = document.getElementById("generateJSON");

  let slots = {};
  let selectedSlot = null;
  let itemsList = [];

  fetch('itemsList.json')
    .then(res => res.json())
    .then(data => { itemsList = data; console.log('Загружено предметов:', itemsList.length); })
    .catch(err => console.error('Ошибка загрузки itemsList:', err));

  function renderGrid() {
    slotsGrid.innerHTML = "";
    const lines = parseInt(menuLinesInput.value) || 3;
    const total = lines * 9;
    for (let i = 0; i < total; i++) {
      const div = document.createElement("div");
      div.className = "slot";
      if (slots[i]) {
        const iconUrl = slots[i].icon || getIconURL(slots[i].item);
        div.innerHTML = `<img src="${iconUrl}" onerror="this.onerror=null;this.parentNode.textContent='${slots[i].item.split(':')[1]}';">`;
      } else {
        div.textContent = i;
      }
      if (i === selectedSlot) div.classList.add("selected");
      div.onclick = () => { selectedSlot = i; loadSlot(i); renderGrid(); };
      slotsGrid.append(div);
    }
  }

  function loadSlot(i) {
    const s = slots[i];
    if (s) {
      itemSearch.value = s.item.replace('minecraft:', '');
      displayNameInput.value = s.display_name || "";
      itemCountInput.value = s.count || 1;
      itemLoreInput.value = s.lore.join("\n") || "";
      hideTooltipInput.checked = !!s.hide_tooltip;
      glowInput.checked = !!s.glow;
      viewLevelInput.value = s.view_requirement.level || 0;
      viewStringInput.value = s.view_requirement.string || "";
      onLeftClickInput.value = s.commands.on_left_click_commands.join("\n");
      onLeftShiftClickInput.value = s.commands.on_left_shift_click_commands.join("\n");
      onRightClickInput.value = s.commands.on_right_click_commands.join("\n");
      onRightShiftClickInput.value = s.commands.on_right_shift_click_commands.join("\n");
      onMiddleClickInput.value = s.commands.on_middle_click_commands.join("\n");
    } else {
      itemSearch.value = "";
      displayNameInput.value = "";
      itemCountInput.value = 1;
      itemLoreInput.value = "";
      hideTooltipInput.checked = false;
      glowInput.checked = false;
      viewLevelInput.value = 0;
      viewStringInput.value = "";
      onLeftClickInput.value = "";
      onLeftShiftClickInput.value = "";
      onRightClickInput.value = "";
      onRightShiftClickInput.value = "";
      onMiddleClickInput.value = "";
    }
  }

  function getIconURL(itemName) {
    const cleanName = itemName.replace('minecraft:', '');
    return `icons/${cleanName}.png`;
  }

itemSearch.addEventListener("input", () => {
  const q = itemSearch.value.trim().toLowerCase();
  itemList.innerHTML = "";
  if (!q) return;
  const found = itemsList
    .filter(name => name.includes(q))
    .sort((a, b) => {
      const aStarts = a.startsWith(q);
      const bStarts = b.startsWith(q);
      if (aStarts && !bStarts) return -1;
      if (!aStarts && bStarts) return 1;
      return a.length - b.length;
    });
  found.slice(0, 20).forEach(name => {
    const div = document.createElement("div");
    div.textContent = name;
    div.onclick = () => {
      itemSearch.value = name;
      itemList.innerHTML = "";
    };
    itemList.appendChild(div);
  });
});


  saveSlotBtn.onclick = () => {
    if (selectedSlot === null) return;
    let itemName = itemSearch.value.trim();
    if (!itemName.includes(":")) itemName = "minecraft:" + itemName.toLowerCase();
    const iconURL = getIconURL(itemName);
    slots[selectedSlot] = {
      item: itemName,
      icon: iconURL,
      count: parseInt(itemCountInput.value) || 1,
      display_name: displayNameInput.value.trim(),
      lore: itemLoreInput.value.split("\n").filter(x => x),
      hide_tooltip: hideTooltipInput.checked,
      glow: glowInput.checked,
      view_requirement: { level: parseInt(viewLevelInput.value) || 0, string: viewStringInput.value.trim() },
      commands: {
        on_left_click_commands: onLeftClickInput.value.split("\n").filter(x => x),
        on_left_shift_click_commands: onLeftShiftClickInput.value.split("\n").filter(x => x),
        on_right_click_commands: onRightClickInput.value.split("\n").filter(x => x),
        on_right_shift_click_commands: onRightShiftClickInput.value.split("\n").filter(x => x),
        on_middle_click_commands: onMiddleClickInput.value.split("\n").filter(x => x)
      }
    };
    selectedSlot = null;
    loadSlot(null);
    renderGrid();
  };

  clearSlotsBtn.onclick = () => { slots = {}; selectedSlot = null; renderGrid(); loadSlot(null); };

  generateJSONBtn.onclick = () => {
    const lines = parseInt(menuLinesInput.value) || 3;
    const total = lines * 9;
    const arr = [];
    for (let i = 0; i < total; i++) {
      if (slots[i]) {
        const s = JSON.parse(JSON.stringify(slots[i]));
        delete s.icon;
        const slotObj = { index: i, ...s };
        arr.push(slotObj);
      }
    }
    const res = {
      menus: {
        [menuNameInput.value]: {
          title: menuTitleInput.value,
          lines: lines,
          close_menu_on_clicked: closeMenuCheckbox.checked,
          commands: {
            on_open_commands: onOpenCommandsInput.value.split("\n").filter(x => x),
            on_closed_commands: onClosedCommandsInput.value.split("\n").filter(x => x)
          },
          slots: arr
        }
      }
    };
    outputPre.textContent = JSON.stringify(res, null, 2);
  };

  menuLinesInput.onchange = () => { renderGrid(); selectedSlot = null; loadSlot(null); };

  renderGrid();
</script>

</body>
</html>
