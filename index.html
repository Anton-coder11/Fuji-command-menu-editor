<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Редактор меню Minecraft</title>
  <style>
    body {
      background: #1e1e2f;
      color: #eee;
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 960px;
      margin: auto;
    }
    #langSelectorWrapper {
      position: fixed;
      top: 15px;
      left: 15px;
      background: linear-gradient(135deg, #3c6ef3 0%, #2b54c3 100%);
      border-radius: 8px;
      padding: 6px 12px 6px 40px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
      font-family: Arial, sans-serif;
      display: flex;
      align-items: center;
      color: #fff;
      cursor: pointer;
      user-select: none;
      font-weight: 600;
      z-index: 1000;
    }
    #langSelector {
      background: transparent;
      border: none;
      color: #fff;
      font-size: 14px;
      appearance: none;
      padding: 0;
      margin: 0;
      cursor: pointer;
      outline: none;
    }
    #langSelectorWrapper::before {
      content: "";
      position: absolute;
      top: 50%;
      left: 12px;
      transform: translateY(-50%);
      width: 20px;
      height: 14px;
      background-size: cover;
      border-radius: 2px;
      pointer-events: none;
      background-repeat: no-repeat;
      background-position: center center;
    }
    h2 { text-align: center; margin-top: 60px; }
    label { display: block; margin: 8px 0 4px; }
    input[type="text"], input[type="number"], textarea {
      width: 100%; padding: 6px 10px; border: none; border-radius: 4px;
      background: #2e2e44; color: #eee; box-sizing: border-box;
    }
    input[type="checkbox"] { margin-right: 6px; vertical-align: middle; }
    button {
      margin: 5px 5px 0 0; padding: 10px 20px; background: #3c6ef3;
      color: #fff; border: none; border-radius: 4px; cursor: pointer;
    }
    button:hover { background: #2b54c3; }
    #slotsGrid {
      display: grid; grid-template-columns: repeat(9, 50px); gap: 6px; margin: 20px 0;
    }
    .slot {
      background: #2a2a40; border-radius: 4px; width: 50px; height: 50px;
      color: #aaa; font-size: 9px; text-align: center; line-height: 50px;
      cursor: pointer; overflow: hidden; position: relative;
    }
    .slot.selected { outline: 3px solid #3c6ef3; }
    .slot img { max-width: 100%; max-height: 100%; display: block; }
    #itemList {
      background: #2a2a40; max-height: 160px; overflow-y: auto; position: relative;
    }
    #itemList div {
      display: flex; align-items: center; padding: 4px 8px; cursor: pointer;
    }
    #itemList div:hover { background: #3c6ef3; }
    #itemList img { width: 24px; height: 24px; margin-right: 8px; }
    pre {
      background: #111; padding: 10px; overflow-x: auto;
      white-space: pre-wrap; word-wrap: break-word;
    }
  </style>
</head>
<body>

<div id="langSelectorWrapper" aria-label="Language selector">
  <select id="langSelector" title="Select language / Выберите язык" aria-live="polite" aria-atomic="true">
    <option value="ru" data-flag="https://flagcdn.com/w20/ru.png">Русский</option>
    <option value="en" data-flag="https://flagcdn.com/w20/gb.png">English</option>
  </select>
</div>

<h2 id="pageTitleH2">Редактор меню Minecraft</h2>

<label id="labelMenusList">Меню:</label>
<select id="menusList"></select>
<button id="newMenu">+ Новое меню</button>
<button id="saveMenu">Сохранить меню</button>

<label id="labelMenuName">Название меню:</label>
<input type="text" id="menuName" placeholder="menu-name">

<label id="labelMenuTitle">Заголовок меню:</label>
<input type="text" id="menuTitle" placeholder="Меню">

<label id="labelMenuLines">Линии (1–6):</label>
<input type="number" id="menuLines" min="1" max="6" value="3">

<label><input type="checkbox" id="closeMenu"><span id="closeMenuLabelText">Закрывать меню при клике</span></label>

<label id="labelOnOpenCommands">Команды при открытии:</label>
<textarea id="onOpenCommands"></textarea>

<label id="labelOnClosedCommands">Команды при закрытии:</label>
<textarea id="onClosedCommands"></textarea>

<h3 id="slotsTitle">Слоты:</h3>
<div id="slotsGrid"></div>

<h3 id="slotEditorTitle">Редактор слота</h3>

<label id="labelItemSearch">Поиск предмета:</label>
<input type="text" id="itemSearch" autocomplete="off">
<div id="itemList"></div>

<label id="labelDisplayName">Имя (display_name):</label>
<input type="text" id="displayName">

<label id="labelItemCount">Количество:</label>
<input type="number" id="itemCount" min="1" max="64" value="1">

<label id="labelItemLore">Лор (по одной строке):</label>
<textarea id="itemLore"></textarea>

<label><input type="checkbox" id="hideTooltip"><span id="hideTooltipLabelText">Скрыть подсказку</span></label>
<label><input type="checkbox" id="glow"><span id="glowLabelText">Подсвечивать</span></label>

<label id="labelViewLevel">View Requirement Level:</label>
<input type="number" id="viewLevel" min="0" value="0">

<label id="labelViewString">View Requirement String:</label>
<input type="text" id="viewString">

<label id="labelOnLeftClick">on_left_click_commands:</label>
<textarea id="onLeftClick"></textarea>

<label id="labelOnLeftShiftClick">on_left_shift_click_commands:</label>
<textarea id="onLeftShiftClick"></textarea>

<label id="labelOnRightClick">on_right_click_commands:</label>
<textarea id="onRightClick"></textarea>

<label id="labelOnRightShiftClick">on_right_shift_click_commands:</label>
<textarea id="onRightShiftClick"></textarea>

<label id="labelOnMiddleClick">on_middle_click_commands:</label>
<textarea id="onMiddleClick"></textarea>

<br/>
<button id="saveSlot">Сохранить слот</button>
<button id="clearSlots">Очистить всё</button>
<button id="generateJSON">Сгенерировать JSON</button>
<button id="downloadJSON">Скачать JSON</button>

<h3 id="resultTitle">Результат JSON:</h3>
<pre id="output"></pre>

<script>
  const langSelector = document.getElementById('langSelector');
  const wrapper = document.getElementById('langSelectorWrapper');

  function updateFlag() {
    const opt = langSelector.options[langSelector.selectedIndex];
    const url = opt.dataset.flag;
    wrapper.style.setProperty('background-image', `url(${url})`);
    wrapper.style.backgroundRepeat = "no-repeat";
    wrapper.style.backgroundPosition = "12px center";
    wrapper.style.paddingLeft = "40px";
  }
  langSelector.addEventListener('change', () => {
    updateFlag();
    updateLanguage(langSelector.value);
  });
  updateFlag();

  let allItems = [];
  fetch('itemsList.json').then(r => r.json()).then(data => allItems = data);

  const slotsGrid = document.getElementById("slotsGrid");
  const menuNameInput = document.getElementById("menuName");
  const menuTitleInput = document.getElementById("menuTitle");
  const menuLinesInput = document.getElementById("menuLines");
  const closeMenuCheckbox = document.getElementById("closeMenu");
  const onOpenCommandsInput = document.getElementById("onOpenCommands");
  const onClosedCommandsInput = document.getElementById("onClosedCommands");

  const itemSearch = document.getElementById("itemSearch");
  const itemList = document.getElementById("itemList");
  const displayNameInput = document.getElementById("displayName");
  const itemCountInput = document.getElementById("itemCount");
  const itemLoreInput = document.getElementById("itemLore");
  const hideTooltipInput = document.getElementById("hideTooltip");
  const glowInput = document.getElementById("glow");
  const viewLevelInput = document.getElementById("viewLevel");
  const viewStringInput = document.getElementById("viewString");
  const onLeftClickInput = document.getElementById("onLeftClick");
  const onLeftShiftClickInput = document.getElementById("onLeftShiftClick");
  const onRightClickInput = document.getElementById("onRightClick");
  const onRightShiftClickInput = document.getElementById("onRightShiftClick");
  const onMiddleClickInput = document.getElementById("onMiddleClick");

  const outputPre = document.getElementById("output");
  const saveSlotBtn = document.getElementById("saveSlot");
  const clearSlotsBtn = document.getElementById("clearSlots");
  const generateJSONBtn = document.getElementById("generateJSON");
  const downloadJSONBtn = document.getElementById("downloadJSON");

  const saveMenuBtn = document.getElementById("saveMenu");
  const newMenuBtn = document.getElementById("newMenu");
  const menusLabel = document.getElementById("labelMenusList");
  const menusList = document.getElementById("menusList");

  let slots = {};
  let selectedSlot = null;
  let menus = {};

  function updateMenusList() {
    menusList.innerHTML = "";
    Object.keys(menus).forEach(name => {
      const opt = document.createElement("option");
      opt.value = name;
      opt.textContent = name;
      menusList.append(opt);
    });
  }

  newMenuBtn.onclick = () => {
    const name = prompt("Введите имя нового меню:");
    if (name && !menus[name]) {
      slots = {};
      selectedSlot = null;
      menuNameInput.value = name;
      menuTitleInput.value = "";
      menuLinesInput.value = 3;
      closeMenuCheckbox.checked = false;
      onOpenCommandsInput.value = "";
      onClosedCommandsInput.value = "";
      menus[name] = { slots: [] };
      updateMenusList();
      menusList.value = name;
      renderGrid();
    }
  };

  saveMenuBtn.onclick = () => {
    if (!menuNameInput.value.trim()) return alert("Введите имя меню");
    const slotsArray = Object.keys(slots).map(i => ({
      index: parseInt(i),
      ...slots[i]
    }));
    menus[menuNameInput.value.trim()] = {
      title: menuTitleInput.value,
      lines: parseInt(menuLinesInput.value) || 3,
      close_menu_on_clicked: closeMenuCheckbox.checked,
      commands: {
        on_open_commands: onOpenCommandsInput.value.split("\n").filter(x => x),
        on_closed_commands: onClosedCommandsInput.value.split("\n").filter(x => x)
      },
      slots: slotsArray
    };
    updateMenusList();
    menusList.value = menuNameInput.value.trim();
    alert("Сохранено меню: " + menuNameInput.value);
  };

  menusList.onchange = () => {
    const name = menusList.value;
    if (!menus[name]) return;
    const m = menus[name];
    menuNameInput.value = name;
    menuTitleInput.value = m.title || "";
    menuLinesInput.value = m.lines || 3;
    closeMenuCheckbox.checked = !!m.close_menu_on_clicked;
    onOpenCommandsInput.value = (m.commands?.on_open_commands || []).join("\n");
    onClosedCommandsInput.value = (m.commands?.on_closed_commands || []).join("\n");
    slots = {};
    (m.slots || []).forEach(s => slots[s.index] = s);
    selectedSlot = null;
    renderGrid();
    loadSlot(null);
  };

  itemSearch.addEventListener("input", () => {
    const val = itemSearch.value.trim().toLowerCase();
    if (!val) { itemList.innerHTML = ''; return; }
    let perfect = allItems.filter(i => i.toLowerCase() === val);
    let partial = allItems.filter(i => i.toLowerCase().includes(val) && i.toLowerCase() !== val);
    let results = [...perfect, ...partial].slice(0, 20);
    itemList.innerHTML = results.map(item => `
      <div data-item="${item}">
        <img src="icons/${item}.png" onerror="this.style.display='none'">
        ${item}
      </div>
    `).join('');
    Array.from(itemList.children).forEach(div => {
      div.onclick = () => {
        itemSearch.value = div.dataset.item;
        itemList.innerHTML = '';
      };
    });
  });
  document.addEventListener('click', e => {
    if (!itemSearch.contains(e.target) && !itemList.contains(e.target)) {
      itemList.innerHTML = '';
    }
  });

  function renderGrid() {
    slotsGrid.innerHTML = "";
    const lines = parseInt(menuLinesInput.value) || 3;
    const total = lines * 9;
    for (let i = 0; i < total; i++) {
      const div = document.createElement("div");
      div.className = "slot";
      if (slots[i]) {
        div.innerHTML = `<img src="icons/${slots[i].item}.png" onerror="this.parentNode.textContent='${slots[i].item}';">`;
      } else {
        div.textContent = i;
      }
      if (i === selectedSlot) div.classList.add("selected");
      div.onclick = () => { selectedSlot = i; loadSlot(i); renderGrid(); };
      slotsGrid.append(div);
    }
  }

  function loadSlot(i) {
    const s = slots[i];
    if (s) {
      itemSearch.value = s.item || "";
      displayNameInput.value = s.display_name || "";
      itemCountInput.value = s.count || 1;
      itemLoreInput.value = s.lore.join("\n") || "";
      hideTooltipInput.checked = !!s.hide_tooltip;
      glowInput.checked = !!s.glow;
      viewLevelInput.value = s.view_requirement?.level || 0;
      viewStringInput.value = s.view_requirement?.string || "";
      onLeftClickInput.value = (s.commands?.on_left_click_commands || []).join("\n");
      onLeftShiftClickInput.value = (s.commands?.on_left_shift_click_commands || []).join("\n");
      onRightClickInput.value = (s.commands?.on_right_click_commands || []).join("\n");
      onRightShiftClickInput.value = (s.commands?.on_right_shift_click_commands || []).join("\n");
      onMiddleClickInput.value = (s.commands?.on_middle_click_commands || []).join("\n");
    } else {
      itemSearch.value = "";
      displayNameInput.value = "";
      itemCountInput.value = 1;
      itemLoreInput.value = "";
      hideTooltipInput.checked = false;
      glowInput.checked = false;
      viewLevelInput.value = 0;
      viewStringInput.value = "";
      onLeftClickInput.value = "";
      onLeftShiftClickInput.value = "";
      onRightClickInput.value = "";
      onRightShiftClickInput.value = "";
      onMiddleClickInput.value = "";
    }
  }

  saveSlotBtn.onclick = () => {
    if (selectedSlot === null) return;
    slots[selectedSlot] = {
      item: itemSearch.value.trim(),
      count: parseInt(itemCountInput.value) || 1,
      display_name: displayNameInput.value.trim(),
      lore: itemLoreInput.value.split("\n").filter(x => x),
      hide_tooltip: hideTooltipInput.checked,
      glow: glowInput.checked,
      view_requirement: { level: parseInt(viewLevelInput.value) || 0, string: viewStringInput.value.trim() },
      commands: {
        on_left_click_commands: onLeftClickInput.value.split("\n").filter(x => x),
        on_left_shift_click_commands: onLeftShiftClickInput.value.split("\n").filter(x => x),
        on_right_click_commands: onRightClickInput.value.split("\n").filter(x => x),
        on_right_shift_click_commands: onRightShiftClickInput.value.split("\n").filter(x => x),
        on_middle_click_commands: onMiddleClickInput.value.split("\n").filter(x => x)
      }
    };
    selectedSlot = null;
    loadSlot(null);
    renderGrid();
  };
  clearSlotsBtn.onclick = () => { slots = {}; selectedSlot = null; renderGrid(); loadSlot(null); };

  generateJSONBtn.onclick = () => {
    outputPre.textContent = JSON.stringify({ menus }, null, 2);
  };

  downloadJSONBtn.onclick = () => {
    const dataStr = JSON.stringify({ menus }, null, 2);
    const blob = new Blob([dataStr], { type: "application/json" });
    const url = URL.createObjectURL(blob);

    const a = document.createElement("a");
    a.href = url;
    a.download = "menus.json";
    a.click();
    URL.revokeObjectURL(url);
  };

  function updateLanguage(lang) {
    if (lang === "en") {
      document.getElementById("pageTitleH2").textContent = "Minecraft Menu Editor";
      menusLabel.textContent = "Menus:";
      newMenuBtn.textContent = "+ New Menu";
      saveMenuBtn.textContent = "Save Menu";
      document.getElementById("labelMenuName").textContent = "Menu Name:";
      document.getElementById("labelMenuTitle").textContent = "Menu Title:";
      document.getElementById("labelMenuLines").textContent = "Lines (1-6):";
      document.getElementById("closeMenuLabelText").textContent = "Close on Click";
      document.getElementById("labelOnOpenCommands").textContent = "On Open Commands:";
      document.getElementById("labelOnClosedCommands").textContent = "On Closed Commands:";
      document.getElementById("slotsTitle").textContent = "Slots:";
      document.getElementById("slotEditorTitle").textContent = "Slot Editor";
      document.getElementById("labelItemSearch").textContent = "Search Item:";
      document.getElementById("labelDisplayName").textContent = "Display Name:";
      document.getElementById("labelItemCount").textContent = "Item Count:";
      document.getElementById("labelItemLore").textContent = "Lore:";
      document.getElementById("hideTooltipLabelText").textContent = "Hide Tooltip";
      document.getElementById("glowLabelText").textContent = "Glow";
      document.getElementById("labelViewLevel").textContent = "View Requirement Level:";
      document.getElementById("labelViewString").textContent = "View Requirement String:";
      document.getElementById("labelOnLeftClick").textContent = "on_left_click_commands:";
      document.getElementById("labelOnLeftShiftClick").textContent = "on_left_shift_click_commands:";
      document.getElementById("labelOnRightClick").textContent = "on_right_click_commands:";
      document.getElementById("labelOnRightShiftClick").textContent = "on_right_shift_click_commands:";
      document.getElementById("labelOnMiddleClick").textContent = "on_middle_click_commands:";
      saveSlotBtn.textContent = "Save Slot";
      clearSlotsBtn.textContent = "Clear All";
      generateJSONBtn.textContent = "Generate JSON";
      downloadJSONBtn.textContent = "Download JSON";
      document.getElementById("resultTitle").textContent = "JSON Result:";
    } else {
      location.reload();
    }
  }

  renderGrid();
</script>

</body>
</html>
